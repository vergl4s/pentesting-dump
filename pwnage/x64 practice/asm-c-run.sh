#!/bin/bash
if [ $# -eq 0 ]
  then
    echo "No arguments supplied"
    exit 1
fi

fn="$(cut -d'.' -f1 <<<$1)"

nasm -felf64 $fn.asm -o /tmp/$fn.o && ld /tmp/$fn.o -o /tmp/$fn

shellcode="$(for i in $(objdump -d /tmp/$fn -M intel |grep '^ ' |cut -f2); do echo -n '\x'$i; done;echo)"

cat << EOF > /tmp/shellcode.c
#include<stdio.h>
#include<string.h>

char code[] = \
"$shellcode";

int main()
{
    printf("Shellcode Length: %d bytes\n", strlen(code));
    int (*ret)() = (int(*)())code;
    ret();
}
EOF

gcc -fno-stack-protector -z execstack /tmp/shellcode.c -o /tmp/shellcode
/tmp/shellcode
